<!DOCTYPE html> <html lang="zh-CN" dir="ltr"> <head> <meta charset="UTF-8"> <!-- SEO --> <title>整装待发 - Handie</title> <!-- 页面渲染兼容性 --> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="renderer" content="webkit"> <meta name="viewport" content="width=device-width,initial-scale=1.0"> <!-- 站点 icon --> <link rel="icon" href="/assets/favicon-3e749ca030e3b71eb2662d947c789061d2da9e0f4ee5f3360cfa9ccbe053c8ba.ico"> <!-- 静态资源 --> <link type="text/css" rel="stylesheet" href="/assets/global-ff8d4eacfdee7e1fc61420d3c8eb571efe442533c12dfc1673fa2b9405736d31.css"> <link type="text/css" rel="stylesheet" href="/assets/share-2811f36e337fef8021089414f657904b7e88db17d8ecade0688c8c3f5e632a5c.css"> <link type="text/css" rel="stylesheet" href="/assets/pages/post-e81e7d6592f92970c97642e26e18867c0bc2e4291bc2dd0c8e438e8c51d3f3b8.css"><link type="text/css" rel="stylesheet" href="/assets/pages/doc-bc8d31e089b9ab0fa613d9d08a527cab89db69249d0eb24225e21a3678a98a50.css"> <script type="text/javascript" src="/assets/global-b3a80dd53acf48ad7228d6fd741dba15d3845cbc3783bdbbf7244151a45628aa.js"></script> </head> <body class="Page" itemscope itemtype="http://schema.org/WebPage"> <header class="Page-header"> <div class="navbar navbar-static-top"> <div class="container-fluid"> <div style="float: right; display: flex; align-items: center; height: 60px; margin: 0 24px 0 30px;"> <a href="https://github.com/handiejs" target="_blank" rel="external nofollow" style="font-size: 24px; color: #333;"><i class="fa fa-github"></i></a> </div> <div class="navbar-header"> <button class="navbar-toggle collapsed" type="button" data-target=".Page-navs" data-toggle="collapse"> <span class="sr-only">切换导航</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a href="/" class="navbar-brand" title="回到首页">Handie</a> </div> <!-- 导航 --> <nav class="Page-navs navbar-collapse collapse"> <ul class="nav navbar-nav navbar-right"> <li class="dropdown"> <a class="dropdown-toggle" href="/learn/" data-toggle="dropdown">学习 <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="/guides/intro/">指南</a></li> <li><a href="/descriptors/model/">API</a></li> </ul> </li> <li><a href="javascript:void(0);">生态</a></li> </ul> </nav> </div> </div> </header> <div class="Page-content"> <aside class="Page-aside"> <nav class="AsideNav"> <ul> <li> <a href="/guides/intro/">初次见面，请多指教！</a> </li> <li> <span>入门教程</span> <ul> <li> <a class="is-selected" href="/guides/getting-started/">整装待发</a> </li> <li> <a href="/guides/directory-structure/">目录结构</a> </li> <li> <a href="/guides/defining-modules/">编写模块</a> </li> <li> <a href="/guides/customization/">定制扩展</a> </li> </ul> </li> </ul> </nav> </aside> <main class="Page-main"> <article class="Article container-fluid"> <header class="Article-header"> <h1 class="Article-title">整装待发</h1> </header> <div class="Article-content col-md-9"><p>为了让初识 Handie 的人能够快速感知到大体轮廓，在《<a href="/guides/intro">初次见面，请多指教！</a>》中着重并简要地介绍了最核心的特色功能——配置化开发与面向业务的模块化开发。</p> <p>光凭那一篇还无以令对 Handie 感兴趣的人真的配出一个可运行的页面，因而有了这一系列「入门教程」。快来跟随我的脚步，一步一步学会如何使用 Handie 吧！</p> <h2 id="section">运行环境</h2> <p>Handie 的核心是平台无关的，也就是说，理论上 Handie 可用于任何支持 JavaScript 的运行环境。然而，在实际使用时或多或少会依赖于运行环境中渲染视图单元的库/框架，故而会针对具体场景在核心之上进行一定的封装与适配，从而形成了 <code>handie-vue</code> 等与运行环境绑定的「壳」。</p> <p>考虑到让「壳」尽量轻量化，它只提供了使中后台前端应用能够配置化开发的底层能力而不内置任何资源型的「物料」，这些通过引入额外的 NPM 包来解决。</p> <p>为方便说明，整套教程基于 <code>handie-vue</code> 进行讲解。虽说如此，就算用其他的「壳」，使用方式别无二致，无需担心。</p> <h3 id="section-1">安装依赖</h3> <p>安装与 Vue 绑定的「壳」和基础部件包 <code>@handie/bulbasaur</code>：</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>npm i -S handie-vue @handie/bulbasaur</code></pre></figure> <p>再安装自己喜欢的 UI 组件库及相应的适配包，以 Element 为例：</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>npm i -S element-ui @kokiri/element</code></pre></figure> <h3 id="section-2">支持组件</h3> <p>由于基础部件包中是基于 Petals 采用基于接口编程的方式使用 UI 组件，不依赖任何具体的 UI 组件库，所以需要另外安装符合 Petals 接口规范的 UI 组件库或适配包，如上面提到的 <code>@kokiri/element</code>。其他情况可以按照常规方式使用 UI 组件。</p> <p>下面是符合 Petals 接口规范的 Vue 组件库或适配包：</p> <table> <thead> <tr> <th>UI 组件库</th> <th>适配包</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td><code>kokiri</code></td> <td>-</td> <td>直接基于 Petals 开发，并支持所有 Petals 中定义的接口</td> </tr> <tr> <td><code>element-ui</code></td> <td><code>@kokiri/element</code></td> <td>-</td> </tr> <tr> <td><code>view-design</code></td> <td><code>@kokiri/view-ui</code></td> <td>-</td> </tr> </tbody> </table> <p>有适配包的 UI 组件库需要两者搭配使用，适配包是在 UI 组件库中已有的 UI 组件的基础上将属性、事件等适配到 Petals 中所定义的接口。</p> <p>为了日后可以无缝替换 UI 组件库以及做测试等，建议在开发时使用适配包中导出的 UI 组件，并采用 Handie 推荐的方式开发。</p> <h2 id="section-3">准备资源</h2> <p>这里所说的「资源」，是让基于 Handie 创建的应用能够正常运作的基石。像控件、部件、渲染器等 UI 组件，及模块定义、模型定义、视图定义、动作定义、主题配置等元数据，都是「资源」，也可称为「物料」。</p> <h3 id="ui-">UI 组件</h3> <p>在 Handie 当前的体系中，根据用途的不同，UI 组件分为<a href="https://www.yuque.com/handie/cookbook/qo4k0r">控件、部件和渲染器</a>这三类，分别可以粗略地理解为：</p> <ul> <li>业务无关且不与 Handie 的机制绑定的是「控件」，像 UI 组件库中的就算是这一类；</li> <li>与 Handie 所提供的抽象（如<a href="https://www.yuque.com/handie/cookbook/txgfzp">动作</a>、<a href="https://www.yuque.com/handie/cookbook/sgvck8">视图与字段</a>等）密切相关，并应用了<a href="https://www.yuque.com/handie/cookbook/qphgck">上下文</a>的是「部件」；</li> <li>通过元数据查找并渲染部件的是「渲染器」。</li> </ul> <p>Handie 官方已经提供了一些现成的 UI 组件，可以拿来即用——</p> <p>一般来说，项目中会有一个专门用来存放 UI 组件的 <code>components</code> 文件夹，在其下为控件、部件和渲染器分别创建对应的文件或文件夹。</p> <p>以控件为例，如果项目相对简单，不需要自定义项目级的控件，只创建一个 <code>control.ts</code> 文件即可，否则就要创建 <code>control</code> 文件夹并用 <code>control/index.ts</code> 文件统一导出所有控件：</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="k">export</span> <span class="o">*</span> <span class="kr">from</span> <span class="s1">&#39;@kokiri/element&#39;</span><span class="p">;</span></code></pre></figure> <p>部件与渲染器基本同理：</p> <figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>components
   ├── widget
   │   └── ...
   ├── control.ts
   └── renderer.ts</code></pre></figure> <p>在 <code>renderer.ts</code> 文件中把渲染器全部导出：</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="k">export</span> <span class="o">*</span> <span class="kr">from</span> <span class="s1">&#39;handie-vue/dist/renderers&#39;</span><span class="p">;</span></code></pre></figure> <p>但部件相对特殊一点，因为已提供的部件比较容易出现不满足业务需求的情况，所以提供了仅保留与上下文交互能力的「无头」部件，以便自定义部件。</p> <p>这样一来，部件所对应的就不是 <code>widget.ts</code> 文件，而是 <code>widget</code> 文件夹，并且 <code>widget</code> 文件夹下还要建一个能够被单独引入的 <code>base.ts</code> 文件：</p> <figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>components
   ├── widget
   │   ├── base.ts
   │   └── index.ts
   ├── control.ts
   └── renderer.ts</code></pre></figure> <p>其中，<code>widget/base.ts</code> 文件的内容为：</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="k">export</span> <span class="o">*</span> <span class="kr">from</span> <span class="s1">&#39;handie-vue/dist/widgets&#39;</span><span class="p">;</span></code></pre></figure> <p>而 <code>widget/index.ts</code> 文件的内容则是：</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="k">export</span> <span class="o">*</span> <span class="kr">from</span> <span class="s1">&#39;@handie/bulbasaur/dist/filter&#39;</span><span class="p">;</span>
<span class="k">export</span> <span class="o">*</span> <span class="kr">from</span> <span class="s1">&#39;@handie/bulbasaur/dist/search&#39;</span><span class="p">;</span>
<span class="k">export</span> <span class="o">*</span> <span class="kr">from</span> <span class="s1">&#39;@handie/bulbasaur/dist/action&#39;</span><span class="p">;</span>
<span class="k">export</span> <span class="o">*</span> <span class="kr">from</span> <span class="s1">&#39;@handie/bulbasaur/dist/field&#39;</span><span class="p">;</span>
<span class="k">export</span> <span class="o">*</span> <span class="kr">from</span> <span class="s1">&#39;@handie/bulbasaur/dist/view&#39;</span><span class="p">;</span></code></pre></figure> <p>若无任何非 Handie 官方提供的部件的话，也可以这样导出：</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="k">export</span> <span class="o">*</span> <span class="kr">from</span> <span class="s1">&#39;@handie/bulbasaur&#39;</span><span class="p">;</span></code></pre></figure> <p>把 UI 组件都准备好后，在 <code>components/index.ts</code> 文件中将它们转化为 UI 组件描述器并导出：</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="k">import</span> <span class="p">{</span> <span class="nx">ComponentType</span><span class="p">,</span> <span class="nx">ComponentCtor</span><span class="p">,</span> <span class="nx">ComponentDescriptor</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;handie-vue&#39;</span><span class="p">;</span>

<span class="k">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">controls</span> <span class="kr">from</span> <span class="s1">&#39;./control&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">widgets</span> <span class="kr">from</span> <span class="s1">&#39;./widget&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">renderers</span> <span class="kr">from</span> <span class="s1">&#39;./renderer&#39;</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">convertToDescriptors</span><span class="p">(</span>
  <span class="nx">map</span><span class="o">:</span> <span class="nx">Record</span><span class="o">&lt;</span><span class="nx">string</span><span class="p">,</span> <span class="nx">ComponentCtor</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">type</span><span class="o">:</span> <span class="nx">ComponentType</span> <span class="o">=</span> <span class="s1">&#39;control&#39;</span><span class="p">,</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">ComponentDescriptor</span><span class="p">[]</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">map</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">name</span> <span class="p">=&gt;</span> <span class="p">({</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">ctor</span><span class="o">:</span> <span class="nx">map</span><span class="p">[</span><span class="nx">name</span><span class="p">],</span> <span class="nx">type</span> <span class="p">}));</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">([]</span> <span class="kr">as</span> <span class="nx">ComponentDescriptor</span><span class="p">[]).</span><span class="nx">concat</span><span class="p">(</span>
  <span class="nx">convertToDescriptors</span><span class="p">(</span><span class="nx">controls</span><span class="p">),</span>
  <span class="nx">convertToDescriptors</span><span class="p">(</span><span class="nx">widgets</span><span class="p">,</span> <span class="s1">&#39;widget&#39;</span><span class="p">),</span>
  <span class="nx">convertToDescriptors</span><span class="p">(</span><span class="nx">renderers</span><span class="p">,</span> <span class="s1">&#39;renderer&#39;</span><span class="p">),</span>
<span class="p">);</span></code></pre></figure> <p>需要注意的是，<strong><code>@/components</code> 仅用于收集 UI 组件相关资源，不可在开发时使用；若要在开发时用 ES Modules 直接引入，需用 <code>@/components/control</code>、<code>@/components/widget</code>、<code>@/components/renderer</code> 这几个路径。</strong></p> <h3 id="section-4">元数据</h3> <h4 id="section-5">模块定义</h4> <p>用来进行模块定义的模块描述器是 Handie 得以运行的必不可少的元数据——如果把它忘了，你将会在网页中看到白花花的一片——什么也没有！</p> <p>模块描述器是一个比较简单的 JavaScript 对象，通过它能够很直观地知道依赖了哪些模块，有哪些可被其他模块使用的资源，模块内用了哪些 UI 组件（不包括用 ES Modules 直接引入的），以及模块所拥有的视图、服务端动作等——可以说，模块描述器相当于物料清单。</p> <p>在 Handie 推荐的<a href="/guides/directory-structure/">目录结构划分模式</a>中，领域/业务模块都存放在 <code>domain</code> 文件夹下；但在常见的中后台前端项目目录结构中，可以把 <code>pages</code> 或 <code>views</code> 文件夹当作 <code>domain</code> 文件夹来用。</p> <p>每个领域/业务模块文件夹下都要有一个用来导出模块描述器的 <code>index.ts</code> 文件：</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="k">import</span> <span class="p">{</span> <span class="nx">ModuleDescriptor</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;handie-vue&#39;</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">AnimationList</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./widgets&#39;</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="c1">// 模块名，需要全局唯一</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;animation&#39;</span><span class="p">,</span>
  <span class="c1">// 所依赖的其他模块的资源</span>
  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;genre.services.getList&#39;</span><span class="p">],</span>
  <span class="c1">// 提供给外部模块使用的资源</span>
  <span class="nx">exports</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">widgets</span><span class="o">:</span> <span class="p">{</span> <span class="nx">AnimationList</span> <span class="p">},</span>
  <span class="p">},</span>
  <span class="c1">// 模块内依赖的控件</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">XIcon</span><span class="o">:</span> <span class="s1">&#39;Icon&#39;</span><span class="p">,</span>
    <span class="nx">XButton</span><span class="o">:</span> <span class="s1">&#39;Button&#39;</span><span class="p">,</span>
    <span class="nx">Wait</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">Ellipsis</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">}</span> <span class="kr">as</span> <span class="nx">ModuleDescriptor</span><span class="p">;</span></code></pre></figure> <p>模块描述器最终会被 Handie 用于模块依赖管控，生成并注入模块上下文，以及查找并创建视图等。</p> <h4 id="section-6">动作定义</h4> <p>TBD</p> <h4 id="section-7">主题配置</h4> <p>TBD</p> <h2 id="section-8">创建应用</h2> <p>要创建应用，需要从 <code>handie-vue</code> 或 <code>handie-vue/dist/vendors/handie</code> 中引入 <code>createApp</code>，两者的主要区别是：前者在后者的基础上封装了 Vue 应用的初始化逻辑，包括对 Vue Router 和 Vuex 等的处理；而后者则是单纯地统一注册 UI 组件、元数据等资源。</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">createApp</span><span class="p">({</span>
  <span class="nx">components</span><span class="p">,</span>
  <span class="nx">metadata</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">actions</span><span class="p">,</span> <span class="c1">// 客户端动作</span>
    <span class="nx">modules</span><span class="p">,</span> <span class="c1">// 领域/业务模块</span>
  <span class="p">},</span>
  <span class="nx">theme</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">icon</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">providers</span><span class="o">:</span> <span class="p">{</span>
        <span class="c1">// ...</span>
      <span class="p">},</span>
    <span class="p">},</span>
    <span class="nx">behavior</span><span class="o">:</span> <span class="p">{</span>
      <span class="c1">// ...</span>
    <span class="p">},</span>
  <span class="p">},</span>
  <span class="cm">/**</span>
<span class="cm">   * 以下内容只有在直接从 `handie-vue` 中引入 `createApp` 时有效</span>
<span class="cm">   */</span>
  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span><span class="nx">Vuex</span><span class="p">,</span> <span class="p">...</span><span class="nx">plugins</span><span class="p">],</span>
  <span class="nx">creators</span><span class="o">:</span> <span class="p">{</span> <span class="nx">store</span><span class="o">:</span> <span class="nx">moduleTree</span> <span class="p">=&gt;</span> <span class="ow">new</span> <span class="nx">Vuex</span><span class="p">.</span><span class="nx">Store</span><span class="p">({</span> <span class="nx">modules</span><span class="o">:</span> <span class="nx">moduleTree</span> <span class="p">})</span> <span class="p">},</span>
  <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#app&#39;</span><span class="p">,</span>
  <span class="nx">routes</span><span class="p">,</span>
<span class="p">});</span></code></pre></figure> <p>上段代码可以直接写在应用入口文件 <code>main.ts</code> 中，也可以写在另外的文件中，如 <code>entry.ts</code>，然后在 <code>main.ts</code> 文件中引入：</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="k">import</span> <span class="s1">&#39;./entry&#39;</span><span class="p">;</span></code></pre></figure> <p>目前 Handie 只支持单应用（计划中要支持多应用），因此所谓的「创建」应用实际上纯粹是「初始化」应用。</p> </div> <footer class="Article-footer col-md-3"> <div class="Widget Widget--share"> <div class="Widget-body"> <p>分享到<i class="fa fa-share-alt"></i></p> <div class="social-share" data-sites="wechat,weibo,twitter"></div> </div> </div> <section class="Widget Widget--toc"> <div class="Widget-header"> <h2 class="Widget-title">目录</h2> </div> <div class="Widget-body"></div> </section> </footer> </article> <footer class="Page-footer Footer"> <div class="container-fluid"> <div class="Footer-description"> <!-- 重要链接 --> <nav class="Footer-navs"> <ul> <li><a href="https://ntks.ourai.ws/" title="让前端开发更加有序，让业务开发专注业务" target="_blank" rel="external nofollow"><span>反混沌</span></a></li> <li><a href="https://petals.fxxk.design/" title="跨 JS-based 技术栈控件（UI 组件）体系" target="_blank" rel="external nofollow"><span>Petals</span></a></li> <li><a href="https://github.com/handiejs" target="_blank" rel="external nofollow"><span>GitHub</span></a></li> </ul> </nav> <!-- 网站版权 --> <div class="Footer-copyright"> <p>&copy; 2016-2022 <a href="https://ntks.ourai.ws/" title="访问「反混沌」" target="_blank" rel="external nofollow">反混沌</a> 版权所有</p> <p>由 <a href="https://ourai.ws/" title="访问「欧雷流」" target="_blank" rel="external nofollow">欧雷</a> 用 ♥ 设计与开发</p> </div> </div> </div> </footer> </main> </div> <script> $('table').addClass('table table-bordered'); $(document).ready(function() { var $el = $('.Page-aside'); var $cnt = $('.Page-content'); $el.on({ 'affixed-top.bs.affix': function() { $el.css('position', 'static'); }, 'affixed.bs.affix': function() { $el.css('position', 'fixed'); } }).affix({ top: $el.offset().top, bottom: function() { return $(document).height() - ($cnt.offset().top + $cnt.outerHeight(true)); } }); }); </script> <script type="text/javascript" src="/assets/share.min-3155ee636b84a04d036e0f1ba833227d3fd03a4c58a6f2e21c9ceb1c5d0198c7.js"></script><script type="text/javascript" src="/assets/components-a266f21fe1dfd61bebf40e74872cbf901eb3e201f7d33e9e5d5af9a55f4b24ea.js"></script> <script type="text/javascript" src="/assets/initializers/time-8d7a529a66ae6cb53c2283d21fd6a12c538b8473dd5bd76458366d09adce7bf6.js"></script><script type="text/javascript" src="/assets/initializers/lazyload-44b7df8a9282d598284d522e64d6be9ac88d466f3c4a734a514303e99347b2c9.js"></script> </body> </html>
